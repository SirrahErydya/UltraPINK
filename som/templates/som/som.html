<div id="loading-wrapper" style="display: none;">
    <div class="loader"></div>
    <p>Generate mapping... Grab a coffee, this may take a while ;)</p>
</div>
<div id="som-container" style="
    background-size: 100%;
    grid-template-columns: repeat({{ active_som.som_width }}, auto);
    grid-template-rows: repeat({{ active_som.som_height}}, calc(80vh/{{ active_som.som_height}}));">
    <div class="magnifier" id="magnify-window" style="display: none;"></div>
    {% for prototype in prototypes %}
        <div class="tooltip prototype">
            <span class="tooltiptext">({{ prototype.x }},{{ prototype.y }})</span>
            <img id="proto{{ prototype.id}}" src="{{ prototype.image }}"
                 onclick="click_image(this.id, {{ prototype.id }},  true)" onmouseover="show_hover_preview(this.id)"/>
        </div>
        <script>
            {% if prototype.label %}
            proto_color("proto{{ prototype.id }}",
                {{ prototype.label.color_r }},
                {{ prototype.label.color_g }},
                {{ prototype.label.color_b}},
                "{{ view }}");
            {% else %}
            proto_color("proto{{ prototype.id }}", 255, 255, 255,
                "{{ view }}");
            {% endif %}
        </script>
    {% endfor %}
</div>
<div class="modal_window" id="modal-window" style="display: none">
    {% load static %}
    <div class="icon">
        <img src="{% static 'main/icons/error.png' %}" onclick="close_cutout_modal()"/>
    </div>
    <div id="modal-header"></div>
    <div id="cutouts" class="cutouts">
    </div>
    <input style="width:300px" id='cutout-label' type="text" value='Label...'/>
    <button id="label-cutouts" class="action-button"
            onclick="label_selected_cutouts(false)">Label selection</button>
    <button id="label-cutouts-proto" class="action-button"
            onclick="label_selected_cutouts(true)">Apply prototype label to selection</button>
    <button id="label-all-cutouts" class="action-button"
            onclick="label_all_cutouts(false)">Label all</button>
    <button id="label-all-cutouts-proto" class="action-button"
            onclick="label_all_cutouts(true)">Apply prototype label to all</button>
    <button id="export-outliers" class="action-button"
            onclick="export_outliers()">Export outliers</button>
</div>
<div class="som-info" id="som-info">
    <table id="info-table">
        <tr>
            <th>Dataset:</th>
            <td>{{ active_som.dataset.dataset_name }}</td>
        </tr>
        <tr>
            <th>Dataset length:</th>
            <td>{{ active_som.dataset.length }}</td>
        </tr>
        <tr>
            <th>Neurons:</th>
            <td>{{ active_som.number_of_neurons }}</td>
        </tr>
        <tr>
            <th>Width:</th>
            <td>{{ active_som.som_width|floatformat:0 }}</td>
        </tr>
        <tr>
            <th>Height:</th>
            <td>{{ active_som.som_height|floatformat:0 }}</td>
        </tr>
        <tr>
            <th>Depth:</th>
            <td>{{ active_som.som_depth|floatformat:0 }}</td>
        </tr>
    </table>
    <br/>
    <div id="label-legend">
        <h3>Labels</h3><br/>
        {% if labels %}
        <div class="label-legend" style="grid-template-rows: repeat({{ labels|length}}, auto)">
        {% for label in labels %}
            {{ label.name }}:
            <div class="square"
                 style="background-color: rgb({{ label.color_r }},{{ label.color_g }},{{ label.color_b }});"></div>
        {% endfor %}
        </div>
        {% else %}
            <i>No labels in this SOM</i>
        {% endif %}
    </div>
    <div id="histogram">
        <h3>Map Histogram</h3>
        {% if active_som.histogram %}
            <img src="{{ active_som.histogram.url }}"/>
        {% endif %}
    </div>
    <div class="proto-preview">
        <div id="prototype-enlargement"></div>
        <div id="proto-info"></div>
    </div>
</div>
{% if active_som.heatmap %}
<script>
    view("{{ view }}", "{{ active_som.heatmap.url }}");
</script>
{% endif %}